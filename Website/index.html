<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Automatic Vision-Based Face Recognition System</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #0f084f4e;
            color: #333;
        }
        header {
            display: flex;
            align-items: center;
            font-size: larger;
            background-color: #070550;
            color: #ff0101;
            padding: 1rem 0;
            text-align: center;
            height: 100px;
        }
        .heading{ 
            overflow: hidden;  
            font-family:'Lucida Sans', 'Lucida Sans Regular', 'Lucida Grande', 'Lucida Sans Unicode', Geneva, Verdana, sans-serif;
            border-right: .15em solid orange; 
            white-space: nowrap; margin: 0 auto; 
            
            animation: typing 3.5s steps(30, end), blink-caret .75s step-end infinite; 
        } 
        @keyframes typing { 
            from { width: 0 } 
            to { width: 100% } 
        } 
        @keyframes blink-caret { 
            from, to { border-color: transparent } 
            50% { border-color: orange } 
        }
        nav {
            display: flex;
            justify-content: center;
            background: #555;
            background-color: #003366;
        }
        nav a {
            color: white;
            text-decoration: none;
            padding: 1rem;
        }
        nav a:hover {
            background-color: #ff7f50;
            border-radius: 100%;
            color: #5f0562;
        }
        main {
            max-width: 800px;
            margin: 2rem auto;
            padding: 1rem;
            background: #fff;
            box-shadow: 8px 8px 7px rgba(1, 1, 0, 0.5);
        }
        section {
            margin-bottom: 2rem;
        }
        .camera-container {
            text-align: center;
            margin: 2rem 0;
        }
        #camera-feed {
            width: 100%;
            max-width: 600px;
            border: 1px solid #ddd;
            background-color: #9e9aa3ce;
        }
        canvas {
            display: none;
        }
        button {
            padding: 0.5rem 1rem;
            border: none;
            background: #5f0562;
            color: #fff;
            cursor: pointer;
            margin: 0.5rem;
        }
        button:hover {
            background: #ff7f50;
            color: #2a0342;
        }
        footer {
            text-align: center;
            padding: 1rem;
            background: #2a0342;
            color: white;
        }
        h2{
            color: #340336;
        }
    </style>
</head>
<body>
    <header>
        <h1 class="heading">Automatic Vision-Based Face Recognition System</h1>
    </header>
    <nav>
        <a href="#objective">Objective</a>
        <a href="#approach">Approach</a>
        <a href="#camera">Camera</a>
    </nav>
    <main>
        <section id="objective">
            <h2>Objective</h2>
            <p>To implement a system for automatic face recognition in large-scale commercial organizations.</p>
        </section> <hr>
        <section id="approach">
            <h2>Approach</h2>
            <ul>
                <li>Store passport-size images of all employees in a database.</li>
                <li>Capture images of employees entering and exiting the organization using CCTV cameras at the main entrance.</li>
                <li>The system should function effectively in various lighting conditions (daylight and ambient light).</li>
            </ul>
        </section><hr>
        <section id="camera">
            <h2>Camera Feed</h2>
            <div class="camera-container">
                <button id="start-camera-btn">Start Camera</button>
                <video id="camera-feed"></video>
                <canvas id="capture-canvas"></canvas>
                <br>
                <button id="capture-btn" disabled>Capture Image</button>
                <button id="stop-camera-btn" disabled>Stop Camera</button>
            </div>
            <div id="captured-image" style="text-align: center; margin-top: 20px;">
                <h3>Captured Image:</h3>
                <img id="captured-photo" alt="Captured Image" style="max-width: 100%; border: 1px solid #ddd;">
            </div>
        </section>
    </main>
    <footer>
        <p>&copy; 2025 Automatic Vision-Based Face Recognition System</p>
    </footer>
    <script>
        const videoElement = document.getElementById('camera-feed');
        const startCameraButton = document.getElementById('start-camera-btn');
        const captureButton = document.getElementById('capture-btn');
        const stopCameraButton = document.getElementById('stop-camera-btn');
        const canvas = document.getElementById('capture-canvas');
        const capturedPhoto = document.getElementById('captured-photo');
        let stream = null;
        async function startCamera() {
            try {
                stream = await navigator.mediaDevices.getUserMedia({ video: true });
                videoElement.srcObject = stream;
                videoElement.play();
                captureButton.disabled = false;
                stopCameraButton.disabled = false;
                startCameraButton.disabled = true;
            } catch (error) {
                alert('Camera access denied or unavailable.');
                console.error(error);
            }
        }
        function stopCamera() {
            if (stream) {
                const tracks = stream.getTracks();
                tracks.forEach(track => track.stop());
                videoElement.srcObject = null;
                stream = null;
                captureButton.disabled = true;
                stopCameraButton.disabled = true;
                startCameraButton.disabled = false;
            }
        }
        function captureImage() {
            const context = canvas.getContext('2d');
            canvas.width = videoElement.videoWidth;
            canvas.height = videoElement.videoHeight;
            context.drawImage(videoElement, 0, 0, canvas.width, canvas.height);
            const imageData = canvas.toDataURL('image/jpeg');
            capturedPhoto.src = imageData;
            // Send the image data to the server
    fetch('/save-image', {
        method: 'POST',
        body: JSON.stringify({ image: imageData }),
        headers: { 'Content-Type': 'application/json' },
    })
    .then(response => response.json())
    .then(data => {
        console.log('Image saved:', data);
    })
    .catch(error => {
        console.error('Error saving image:', error);
    });
}
        
        startCameraButton.addEventListener('click', startCamera);
        captureButton.addEventListener('click', captureImage);
        stopCameraButton.addEventListener('click', stopCamera);



        async function registerEmployee(imageData) {
    try {
        const formData = new FormData();
        formData.append('photo', imageData, 'passport-photo.png');
        formData.append('name', 'John Doe'); // Replace with form input
        formData.append('employeeId', '12345'); // Replace with form input

        const response = await fetch('http://localhost:5000/api/images/register', {
            method: 'POST',
            body: formData,
        });

        if (response.ok) {
            alert('Employee registered successfully');
        } else {
            alert('Registration failed');
        }
    } catch (error) {
        console.error('Error registering employee:', error);
    }
}

async function recognizeEmployee(imageData) {
    try {
        const formData = new FormData();
        formData.append('photo', imageData, 'captured-image.png');

        const response = await fetch('http://localhost:5000/api/images/recognize', {
            method: 'POST',
            body: formData,
        });

        if (response.ok) {
            const result = await response.json();
            alert(`Employee recognized: ${result.message}`);
        } else {
            alert('Recognition failed');
        }
    } catch (error) {
        console.error('Error recognizing employee:', error);
    }
}

function captureAndUpload(action) {
    const context = canvas.getContext('2d');
    canvas.width = videoElement.videoWidth;
    canvas.height = videoElement.videoHeight;
    context.drawImage(videoElement, 0, 0, canvas.width, canvas.height);

    canvas.toBlob((imageData) => {
        if (action === 'register') {
            registerEmployee(imageData);
        } else if (action === 'recognize') {
            recognizeEmployee(imageData);
        }
    }, 'image/png');
}

    </script>
</body>
</html>
